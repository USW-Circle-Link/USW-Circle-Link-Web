"use strict";(self["webpackChunkdonggurami"]=self["webpackChunkdonggurami"]||[]).push([[589],{7589:function(e,t,n){n.r(t),n.d(t,{default:function(){return X}});var i=n(6768),o=n(4232),s=n(5130),a=n(2159);const l={class:"notice-write-container"},r={key:1},c={class:"title-container",style:{position:"relative"}},p={key:0,class:"popup-overlay"},u={class:"popup"},h={class:"popup-buttons"},d={key:1,class:"popup-overlay"},g={class:"unexpectedPopup"},m={class:"unexpectedPopup-buttons"},L={class:"content-container"},k={class:"textarea-wrapper"},C={key:0,class:"error-text"},v={class:"image-upload-container"},f=["src"],E=["onClick"],b=["onClick"],w=["onChange"],x={key:0,class:"image-upload"},y=["disabled"];function I(e,t,n,I,T,P){const U=(0,i.g2)("Popup401");return(0,i.uX)(),(0,i.CE)("div",l,[t[17]||(t[17]=(0,i.Lk)("h2",{class:"title"},"공지사항 작성",-1)),t[18]||(t[18]=(0,i.Lk)("p",null,null,-1)),T.show401Popup?((0,i.uX)(),(0,i.Wv)(U,{key:0})):(0,i.Q3)("",!0),T.notice?((0,i.uX)(),(0,i.CE)("div",r,[(0,i.Lk)("div",c,[t[9]||(t[9]=(0,i.Lk)("label",{for:"title-input",class:"label"},"제목",-1)),(0,i.bo)((0,i.Lk)("input",{id:"title-input","onUpdate:modelValue":t[0]||(t[0]=e=>T.notice.noticeTitle=e),onInput:t[1]||(t[1]=(...e)=>P.limitTitleLength&&P.limitTitleLength(...e)),class:(0,o.C4)([{"input-error":T.notice.noticeTitle.length>=T.titleMaxLength},"title-input"]),placeholder:"제목을 입력해 주세요. (200자 이내)"},null,34),[[s.Jo,T.notice.noticeTitle]]),(0,i.Lk)("div",{class:(0,o.C4)(["title-character-count",{"error-text":T.notice.noticeTitle.length>=T.titleMaxLength}])},(0,o.v_)(T.notice.noticeTitle.length)+" / "+(0,o.v_)(T.titleMaxLength),3),(0,i.bo)((0,i.Lk)("span",{class:"error-text"},(0,o.v_)(T.titleError),513),[[s.aG,T.titleError]])]),T.showSuccessPopup?((0,i.uX)(),(0,i.CE)("div",p,[(0,i.Lk)("div",u,[t[10]||(t[10]=(0,i.Lk)("h2",null,"동구라미",-1)),t[11]||(t[11]=(0,i.Lk)("hr",null,null,-1)),t[12]||(t[12]=(0,i.Lk)("p",{class:"confirm-message"},"공지사항이 정상적으로 저장되었어요.",-1)),(0,i.Lk)("div",h,[(0,i.Lk)("button",{onClick:t[2]||(t[2]=(...e)=>P.closeSuccessPopup&&P.closeSuccessPopup(...e))},"확인")])])])):(0,i.Q3)("",!0),T.showUnexpectedErrorPopup?((0,i.uX)(),(0,i.CE)("div",d,[(0,i.Lk)("div",g,[t[13]||(t[13]=(0,i.Lk)("h2",null,"동구라미",-1)),t[14]||(t[14]=(0,i.Lk)("hr",null,null,-1)),t[15]||(t[15]=(0,i.Lk)("p",{class:"confirm-message"},[(0,i.Lk)("span",{class:"error-highlight"},"예기치 못한 오류"),(0,i.eW)("가 발생했습니다."),(0,i.Lk)("br"),(0,i.eW)("문제가 계속될 시, 관리자에게 문의해주세요.")],-1)),(0,i.Lk)("div",m,[(0,i.Lk)("button",{onClick:t[3]||(t[3]=(...e)=>P.hideUnexpectedErrorPopup&&P.hideUnexpectedErrorPopup(...e))},"확인")])])])):(0,i.Q3)("",!0),(0,i.Lk)("div",L,[(0,i.Lk)("div",k,[(0,i.bo)((0,i.Lk)("textarea",{id:"content-input","onUpdate:modelValue":t[4]||(t[4]=e=>T.notice.noticeContent=e),onInput:t[5]||(t[5]=(...e)=>P.limitContentLength&&P.limitContentLength(...e)),class:(0,o.C4)([{"input-error":T.notice.noticeContent.length>=T.contentMaxLength},"content-input"]),placeholder:"내용을 입력해 주세요. 사진은 5장까지 첨부 가능합니다."},null,34),[[s.Jo,T.notice.noticeContent]]),(0,i.Lk)("div",{class:(0,o.C4)(["character-count",{"error-text":T.notice.noticeContent.length>=T.contentMaxLength}])},(0,o.v_)(T.notice.noticeContent.length)+" / "+(0,o.v_)(T.contentMaxLength),3),T.contentError?((0,i.uX)(),(0,i.CE)("span",C,(0,o.v_)(T.contentError),1)):(0,i.Q3)("",!0)])]),(0,i.Lk)("div",v,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(T.images,(e,n)=>((0,i.uX)(),(0,i.CE)("div",{key:n,class:"image-preview"},[(0,i.Lk)("img",{src:e.src,alt:"Uploaded Image",class:"uploaded-image"},null,8,f),(0,i.Lk)("div",{class:"edit-icon",onClick:e=>P.editImage(n)},t[16]||(t[16]=[(0,i.Lk)("img",{src:a,alt:"Edit Icon"},null,-1)]),8,E),(0,i.Lk)("div",{class:"delete-icon",onClick:e=>P.deleteImage(n)}," × ",8,b),(0,i.Lk)("input",{type:"file",ref_for:!0,ref:"fileInput"+n,onChange:e=>P.onImageChange(n,e),style:{display:"none"}},null,40,w)]))),128)),T.images.length<5?((0,i.uX)(),(0,i.CE)("div",x,[(0,i.Lk)("input",{type:"file",onChange:t[6]||(t[6]=(...e)=>P.onImageUpload&&P.onImageUpload(...e))},null,32),(0,i.Lk)("div",{class:"plus",onClick:t[7]||(t[7]=e=>e.target.previousElementSibling.click())}," + ")])):(0,i.Q3)("",!0)]),(0,i.Lk)("button",{class:"submit-button",onClick:t[8]||(t[8]=(...e)=>P.submitNotice&&P.submitNotice(...e)),disabled:T.isLoading}," 완료 ",8,y)])):(0,i.Q3)("",!0)])}var T=n(4373),P=n(5968),U=n(3657),M={name:"NoticeWrite",components:{Popup401:U.A},props:["noticeUUID"],data(){return{notice:{noticeTitle:"",noticeContent:""},images:[],show401Popup:!1,showSuccessPopup:!1,isLoading:!1,titleError:"",contentError:"",titleMaxLength:200,contentMaxLength:3e3,showUnexpectedErrorPopup:!1}},methods:{limitTitleLength(){this.notice.noticeTitle.length>this.titleMaxLength&&(this.notice.noticeTitle=this.notice.noticeTitle.slice(0,this.titleMaxLength))},limitContentLength(){this.notice.noticeContent.length>this.contentMaxLength&&(this.notice.noticeContent=this.notice.noticeContent.slice(0,this.contentMaxLength))},closeSuccessPopup(){this.showSuccessPopup=!1,this.$router.push({name:"Notice"})},deleteImage(e){this.images.splice(e,1),this.$refs[`fileInput${e}`]=null},hideUnexpectedErrorPopup(){this.showUnexpectedErrorPopup=!1},handle401Error(e){return!(!e.response||401!==e.response.status)&&(this.show401Popup=!0,!0)},onImageUpload(e){const t=e.target.files[0];if(t){const n=["png","jpg","jpeg"],i=t.name.split(".").pop().toLowerCase(),o=10485760;if(n.includes(i)&&t.size<=o){const n=new FileReader;n.onload=n=>{this.images.push({src:n.target.result,file:t}),e.target.value=""},n.readAsDataURL(t)}else alert("파일 형식이 맞지 않거나 크기가 초과되었습니다. (10MB 이하, png/jpg만 허용)")}},editImage(e){this.$refs[`fileInput${e}`][0].click()},onImageChange(e,t){if(!t||!t.target||!t.target.files)return void console.error("Invalid event object:",t);const n=t.target.files[0];if(!n)return;const i=["png","jpg","jpeg","gif","bmp","webp","tiff"],o=n.name.split(".").pop().toLowerCase(),s=10485760;if(i.includes(o)&&n.size<=s){const t=new FileReader;t.onload=t=>{this.images[e]={...this.images[e],src:t.target.result,file:n}},t.readAsDataURL(n)}else alert("파일 형식이 맞지 않거나 크기가 초과되었습니다. (10MB 이하, png/jpg만 허용)")},async submitNotice(){""===this.notice.noticeTitle.trim()?this.titleError="* 제목을 입력해주세요.":this.titleError="",""===this.notice.noticeContent.trim()?this.contentError="* 내용을 입력해주세요.":this.contentError="";try{this.isLoading=!0;const e=new FormData,t={noticeTitle:this.notice.noticeTitle,noticeContent:this.notice.noticeContent.replace(/ /g,"&nbsp;").replace(/\n/g,"<br>"),photoOrders:this.images.length>0?this.images.map((e,t)=>t+1):[]};e.append("request",new Blob([JSON.stringify(t)],{type:"application/json"})),this.images.length>0&&this.images.forEach(t=>{e.append("photos",t.file)});const n=await T.A.post(`${P.A.state.apiBaseUrl}/notices`,e,{headers:{Authorization:`Bearer ${P.A.state.accessToken}`,"Content-Type":"multipart/form-data"}});if(200===n.status&&(this.showSuccessPopup=!0),!n||!n.data)return void console.error("응답 데이터 없음");if([401].includes(n.status)){let e="";return 401===n.status&&(e="인증되지 않은 사용자입니다. 다시 로그인해주세요.",this.$router.push({name:"Login"})),void alert(e)}const i=n?.data?.data||[];Array.isArray(i)&&i.length>0&&await Promise.all(i.map(async(e,t)=>{const n=this.images[t].file;await T.A.put(e,n,{headers:{"Content-Type":n.type}})}))}catch(e){if(e.response&&401===e.response.status)return void(this.show401Popup=!0);const t=e?.response?.data?.code;if("MAX_UPLOAD_SIZE_EXCEEDED"===t)return void alert(e.response.data.message);if("INVALID_TITLE_OR_CONTENT"===t){const t=e.response.data.additionalData||{};return t.noticeTitle&&(this.titleError=t.noticeTitle),void(t.noticeContent&&(this.contentError=t.noticeContent))}console.error("공지사항 제출 실패:",e.response||e.message)}finally{this.isLoading=!1}}}},_=n(1241);const A=(0,_.A)(M,[["render",I],["__scopeId","data-v-46bb59b0"]]);var X=A}}]);
//# sourceMappingURL=589.aa507adf.js.map