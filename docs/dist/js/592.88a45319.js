"use strict";(self["webpackChunkdonggurami"]=self["webpackChunkdonggurami"]||[]).push([[592],{9967:function(e,t,s){s.r(t),s.d(t,{default:function(){return V}});var a=s(6768),i=s(5130),r=s(4232),o=s(2159),l=s.p+"img/plus.0e58c1a8.svg";const n={class:"whole-container"},c={class:"image-upload-container"},p={key:0,class:"image-preview"},d=["src"],u=["onClick"],h=["onClick"],g=["onChange"],k={key:1,class:"image-upload"},C=["onChange"],m={class:"ClubTextInput"},f={class:"textarea-container"},L={class:"textSize"},x={class:"ClubRecruitHeader"},b={class:"head"},v=["readonly"],w={class:"textarea-container"},y=["readonly"],U={class:"textSize"},I=["readonly"],E=["readonly"],R={key:0,class:"popup-overlay"},P={class:"popup"},D={class:"popup-buttons"},A={key:1,class:"popup-overlay"},T={class:"unexpectedPopup"},S={class:"unexpectedPopup-buttons"};function z(e,t,s,z,F,O){const $=(0,a.g2)("Popup401");return(0,a.uX)(),(0,a.CE)("div",n,[t[22]||(t[22]=(0,a.Lk)("div",{class:"head"},[(0,a.Lk)("h2",null,"동아리 활동 사진"),(0,a.Lk)("div",{class:"empty"}),(0,a.Lk)("div",{class:"warning-text"},"동아리와 관련 없는 사진 업로드 시, 권한이 제한될 수 있습니다.")],-1)),(0,a.Lk)("div",c,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(F.images,(e,s)=>((0,a.uX)(),(0,a.CE)("div",{key:s,class:"image-preview"},[e.src?((0,a.uX)(),(0,a.CE)("div",p,[(0,a.Lk)("img",{src:e.src,alt:"Uploaded Image",class:"uploaded-image",oncontextmenu:"return false;"},null,8,d),(0,a.Lk)("div",{class:"edit-icon",onClick:e=>O.triggerFileInput(s)},t[11]||(t[11]=[(0,a.Lk)("img",{src:o,alt:"Edit Icon"},null,-1)]),8,u),(0,a.Lk)("div",{class:"delete-icon",onClick:e=>O.deleteImage(s)}," × ",8,h),(0,a.Lk)("input",{type:"file",ref_for:!0,ref:"fileInput"+s,onChange:e=>O.onFileChange(s,e),style:{display:"none"}},null,40,g)])):((0,a.uX)(),(0,a.CE)("div",k,[(0,a.Lk)("input",{type:"file",onChange:e=>O.onImageUpload(s,e)},null,40,C),(0,a.Lk)("div",{class:"plus",onClick:t[0]||(t[0]=e=>e.currentTarget.previousElementSibling.click())},t[12]||(t[12]=[(0,a.Lk)("img",{src:l,alt:"이미지 추가"},null,-1)]))]))]))),128))]),t[23]||(t[23]=(0,a.Lk)("div",{class:"ClubUpdateHeader"},[(0,a.Lk)("div",{class:"head"},[(0,a.Lk)("h2",null,"동아리 소개 글 수정")])],-1)),(0,a.Lk)("div",m,[(0,a.Lk)("div",f,[(0,a.bo)((0,a.Lk)("textarea",{placeholder:"동아리에 대해 자유롭게 설명해주세요.","onUpdate:modelValue":t[1]||(t[1]=e=>F.textareaContent=e),rows:"10",cols:"50",class:"preserve-whitespace",onInput:t[2]||(t[2]=(...e)=>O.updateTextSize&&O.updateTextSize(...e))},null,544),[[i.Jo,F.textareaContent]]),(0,a.Lk)("p",L,(0,r.v_)(F.textSize)+" / 3000",1)])]),(0,a.Lk)("div",x,[(0,a.Lk)("div",b,[t[13]||(t[13]=(0,a.Lk)("h2",null,"동아리 모집 글 수정",-1)),t[14]||(t[14]=(0,a.Lk)("div",{class:"empty"},null,-1)),t[15]||(t[15]=(0,a.Lk)("p",null,"모집 중",-1)),(0,a.bo)((0,a.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[3]||(t[3]=e=>F.isChecked=e),id:"chk1"},null,512),[[i.lH,F.isChecked]]),(0,a.Lk)("label",{for:"switch",onClick:t[4]||(t[4]=(...e)=>O.toggleCheckbox&&O.toggleCheckbox(...e))})])]),(0,a.Lk)("div",{class:(0,r.C4)(["ClubTextInput",{RecruitToggleOff:!F.isChecked}]),id:"RecruitInputSpace",readonly:!F.isChecked},[(0,a.Lk)("div",w,[(0,a.bo)((0,a.Lk)("textarea",{placeholder:"동아리 모집에 대해 자유롭게 설명해주세요.","onUpdate:modelValue":t[5]||(t[5]=e=>F.textareaRecruitContent=e),readonly:!F.isChecked,class:(0,r.C4)([{RecruitToggleOff:!F.isChecked},"preserve-whitespace"]),rows:"10",cols:"50",onInput:t[6]||(t[6]=(...e)=>O.updateRecruitTextSize&&O.updateRecruitTextSize(...e))},null,42,y),[[i.Jo,F.textareaRecruitContent]]),(0,a.Lk)("p",U,(0,r.v_)(F.RecruittextSize)+" / 3000",1)])],10,v),t[24]||(t[24]=(0,a.Lk)("div",{class:"head"},[(0,a.Lk)("h2",null,"지원서 링크")],-1)),(0,a.Lk)("div",{class:(0,r.C4)(["GoogleFormLinkInput",{RecruitToggleOff:!F.isChecked}]),readonly:!F.isChecked},[(0,a.bo)((0,a.Lk)("textarea",{placeholder:"링크를 입력해 주세요","onUpdate:modelValue":t[7]||(t[7]=e=>F.googleFormLink=e),rows:"4",cols:"1",readonly:!F.isChecked,class:(0,r.C4)({RecruitToggleOff:!F.isChecked})},null,10,E),[[i.Jo,F.googleFormLink]])],10,I),(0,a.Lk)("button",{onClick:t[8]||(t[8]=(...e)=>O.saveInfo&&O.saveInfo(...e))},"작성 완료"),F.showConfirmPopup?((0,a.uX)(),(0,a.CE)("div",R,[(0,a.Lk)("div",P,[t[16]||(t[16]=(0,a.Lk)("h2",null,"동아리 소개/모집",-1)),t[17]||(t[17]=(0,a.Lk)("hr",null,null,-1)),t[18]||(t[18]=(0,a.Lk)("p",{class:"confirm-message"},"동아리 소개/모집 글 작성이 완료되었습니다.",-1)),(0,a.Lk)("div",D,[(0,a.Lk)("button",{onClick:t[9]||(t[9]=(...e)=>O.hidePopup&&O.hidePopup(...e))},"확인")])])])):(0,a.Q3)("",!0),F.showUnexpectedErrorPopup?((0,a.uX)(),(0,a.CE)("div",A,[(0,a.Lk)("div",T,[t[19]||(t[19]=(0,a.Lk)("h2",null,"동구라미",-1)),t[20]||(t[20]=(0,a.Lk)("hr",null,null,-1)),t[21]||(t[21]=(0,a.Lk)("p",{class:"confirm-message"},[(0,a.Lk)("span",{class:"error-highlight"},"예기치 못한 오류"),(0,a.eW)("가 발생했습니다."),(0,a.Lk)("br"),(0,a.eW)("문제가 계속될 시, 관리자에게 문의해주세요.")],-1)),(0,a.Lk)("div",S,[(0,a.Lk)("button",{onClick:t[10]||(t[10]=(...e)=>O.hideUnexpectedErrorPopup&&O.hideUnexpectedErrorPopup(...e))},"확인")])])])):(0,a.Q3)("",!0),F.show401Popup?((0,a.uX)(),(0,a.Wv)($,{key:2})):(0,a.Q3)("",!0)])}var F=s(4373),O=s(5968),$=s(8057),X={name:"ClubInfoTextInput",components:{Popup401:$.A},data(){return{images:[{src:""},{src:""},{src:""},{src:""},{src:""}],textareaContent:"",textareaRecruitContent:"",isChecked:null,googleFormLink:"",orders:[],deletedOrders:[],file:[],presignedUrls:[],imagesData:[],errorMessage:"",validFile:!1,clubData:{},textSize:0,RecruittextSize:0,showConfirmPopup:!1,show401Popup:!1,showUnexpectedErrorPopup:!1}},mounted(){this.fetchClubInfo()},methods:{handle401Error(e){return!(!e.response||401!==e.response.status)&&(this.show401Popup=!0,!0)},async fetchClubInfo(){const e=O.A.state.clubUUID,t=O.A.state.accessToken;try{const s=await F.A.get(`${O.A.state.apiBaseUrl}/club-leader/${e}/intro`,{headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}});this.clubData=s.data.data,this.isChecked="OPEN"===this.clubData.recruitmentStatus,this.textareaContent=(this.clubData.clubIntro||"").replace(/\n?<br>\n?/gi,"\n").replace(/&nbsp;/g," "),this.textareaRecruitContent=(this.clubData.clubRecruitment||this.textareaRecruitContent).replace(/\n?<br>\n?/gi,"\n").replace(/&nbsp;/g," "),this.googleFormLink=this.clubData.googleFormUrl||"",this.images=Array(5).fill({src:""}),(this.clubData.introPhotos||[]).forEach((e,t)=>{e&&(this.images[t]={src:e})})}catch(s){this.handle401Error(s)||alert("동아리 정보를 불러오는데 실패했습니다.")}this.updateTextSize(),this.updateRecruitTextSize()},navigateTo(e){this.$router.push({name:e}).catch(e=>{if("NavigationDuplicated"!==e.name)throw e})},deleteImage(e){this.pastImages=this.images;try{this.images.splice(e,1,{src:""}),this.orders.splice(this.orders.indexOf(e+1),1),this.deletedOrders.splice(e,0,e+1),this.deletedOrders.sort(),this.$forceUpdate()}catch(t){console.error("Error while deleting image:",t)}},async toggleCheckbox(){const e=O.A.state.accessToken,t=O.A.state.clubUUID;this.isChecked=!this.isChecked,this.$emit("sendData",this.isChecked),F.A.patch(`${O.A.state.apiBaseUrl}/club-leader/${t}/recruitment`,{key:this.isChecked},{headers:{Authorization:`Bearer ${e}`}}).then(e=>{this.isChecked}).catch(e=>console.error("Error:",e))},triggerFileInput(e){const t=this.$refs[`fileInput${e}`];t&&t[0]&&t[0].click&&t[0].click()},onFileChange(e,t){if(this.images.splice(e,1,{src:""}),this.images.filter(e=>""!==e.src).length>=5)return void alert("이미지는 최대 5개까지 업로드할 수 있습니다.");const s=t.target.files[0];if(s){const t=["png","jpg","jpeg","gif","bmp","webp","tiff"],a=s.name.split(".").pop().toLowerCase(),i=10485760;if(t.includes(a)&&s.size<i){this.file.splice(e,1,s),this.errorMessage="",this.validFile=!0;const t=new FileReader;t.onload=t=>{this.images[e].src=t.target.result,this.imagesData.push({src:t.target.result,file:s})},t.readAsDataURL(s),this.orders.splice(e,0,e+1),this.orders.sort()}else alert("파일 형식이 맞지 않습니다. \n10MB 이하 .png, .jpg, .jpeg, .gif, .bmp, .webp, .tiff 형식의 파일을 입력하세요."),this.errorMessage="파일 형식이 맞지 않습니다.",this.validFile=!1}},onImageUpload(e,t){const s=t.target.files[0];if(s){const t=["png","jpg","jpeg","gif","bmp","webp","tiff"],a=s.name.split(".").pop().toLowerCase(),i=10485760;if(t.includes(a)&&s.size<i){this.file.push(s),this.deletedOrders.splice(this.deletedOrders.indexOf(e+1),1),this.orders.splice(e,0,e+1),this.orders.sort();const t=new FileReader;t.onload=t=>{this.images.splice(e,1,{src:t.target.result}),this.imagesData.push({src:t.target.result,file:s})},t.readAsDataURL(s)}else alert("파일 형식이 맞지 않습니다.")}},showPopup(){this.showConfirmPopup=!0},hidePopup(){this.showConfirmPopup=!1},hideUnexpectedErrorPopup(){this.showUnexpectedErrorPopup=!1},async saveInfo(){const e=O.A.state.clubUUID,t=O.A.state.accessToken,s=new FormData,a={clubIntro:this.textareaContent.replace(/ /g,"&nbsp;").replace(/\n/g,"<br>"),recruitmentStatus:this.isChecked?"OPEN":"CLOSE",clubRecruitment:this.textareaRecruitContent.replace(/ /g,"&nbsp;").replace(/\n/g,"<br>"),googleFormUrl:this.googleFormLink,orders:this.orders||this.clubData.orders,deletedOrders:this.deletedOrders};s.append("clubIntroRequest",new Blob([JSON.stringify(a)],{type:"application/json"})),this.imagesData.forEach((e,t)=>{s.append("introPhotos",e.file)});try{const a=await F.A.put(`${O.A.state.apiBaseUrl}/club-leader/${e}/intro`,s,{headers:{Authorization:`Bearer ${t}`,"Content-Type":"multipart/form-data"}});a.data&&a.data.data&&a.data.data.presignedUrls&&(this.presignedUrls=a.data.data.presignedUrls,await this.uploadFiles()),this.showPopup(),this.$emit("data-saved")}catch(i){const e=i.response?.data;if("CLP-201"===e?.code)return void alert("범위를 벗어난 사진 순서 값입니다.");if("MAX_UPLOAD_SIZE_EXCEEDED"===e?.code)return void alert("업로드 가능한 최대 파일 크기를 초과했습니다. (개별 파일 10MB, 총 파일 크기 50MB)");if("INVALID_ARGUMENT"===e?.code)return void(this.showUnexpectedErrorPopup=!0)}},async uploadFiles(){try{await Promise.all(this.presignedUrls.map(async(e,t)=>{await F.A.put(e,this.imagesData[t].file,{headers:{"Content-Type":this.imagesData[t].file.type}})}))}catch(e){alert("파일 업로드 실패!")}},updateTextSize(){this.textareaContent.length>3e3&&(alert("문자 수가 3000자를 초과했습니다."),this.textareaContent=this.textareaContent.slice(0,3e3)),this.textSize=this.textareaContent.length},updateRecruitTextSize(){this.textareaRecruitContent.length>3e3&&(alert("문자 수가 3000자를 초과했습니다."),this.textareaRecruitContent=this.textareaRecruitContent.slice(0,3e3)),this.RecruittextSize=this.textareaRecruitContent.length}}},_=s(1241);const B=(0,_.A)(X,[["render",z],["__scopeId","data-v-4f982420"]]);var j=B,M={__name:"intro",setup(e){return(e,t)=>((0,a.uX)(),(0,a.Wv)(j))}};const N=M;var V=N}}]);
//# sourceMappingURL=592.88a45319.js.map