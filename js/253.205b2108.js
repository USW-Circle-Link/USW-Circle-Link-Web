"use strict";(self["webpackChunkdonggurami"]=self["webpackChunkdonggurami"]||[]).push([[253],{8253:function(e,t,n){n.r(t),n.d(t,{default:function(){return T}});var i=n(6768),o=n(5130),s=n(4232),a=n(2159);const l={class:"notice-write-container"},r={key:0},c={class:"title-container"},p={class:"content-container"},u={class:"textarea-wrapper"},d={class:"character-count"},g={class:"image-upload-container"},h=["src"],m=["onClick"],f=["onClick"],k=["onChange"],C={key:0,class:"image-upload"},v=["disabled"];function L(e,t,n,L,b,I){const w=(0,i.g2)("Popup401");return(0,i.uX)(),(0,i.CE)(i.FK,null,[(0,i.Lk)("div",l,[t[8]||(t[8]=(0,i.Lk)("h2",{class:"title"},"공지사항 작성",-1)),b.notice?((0,i.uX)(),(0,i.CE)("div",r,[(0,i.Lk)("div",c,[t[6]||(t[6]=(0,i.Lk)("label",{for:"title-input",class:"label"},"제목",-1)),(0,i.bo)((0,i.Lk)("input",{id:"title-input","onUpdate:modelValue":t[0]||(t[0]=e=>b.notice.noticeTitle=e),class:"title-input",placeholder:"제목을 입력해 주세요. (200자 이내)"},null,512),[[o.Jo,b.notice.noticeTitle]])]),(0,i.Lk)("div",p,[(0,i.Lk)("div",u,[(0,i.bo)((0,i.Lk)("textarea",{id:"content-input","onUpdate:modelValue":t[1]||(t[1]=e=>b.notice.noticeContent=e),class:"content-input",placeholder:"내용을 입력해 주세요. 사진은 5장까지 첨부 가능합니다.",onInput:t[2]||(t[2]=(...t)=>e.limitContentLength&&e.limitContentLength(...t))},null,544),[[o.Jo,b.notice.noticeContent]]),(0,i.Lk)("div",d,(0,s.v_)(b.notice.noticeContent.length)+" / 3000",1)])]),(0,i.Lk)("div",g,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(b.images,(e,n)=>((0,i.uX)(),(0,i.CE)("div",{key:n,class:"image-preview"},[(0,i.Lk)("img",{src:e.src,alt:"Uploaded Image",class:"uploaded-image"},null,8,h),(0,i.Lk)("div",{class:"edit-icon",onClick:e=>I.editImage(n)},t[7]||(t[7]=[(0,i.Lk)("img",{src:a,alt:"Edit Icon"},null,-1)]),8,m),(0,i.Lk)("div",{class:"delete-icon",onClick:e=>I.deleteImage(n)}," × ",8,f),(0,i.Lk)("input",{type:"file",ref_for:!0,ref:"fileInput"+n,onChange:e=>I.onImageChange(n,e),style:{display:"none"}},null,40,k)]))),128)),b.images.length<5?((0,i.uX)(),(0,i.CE)("div",C,[(0,i.Lk)("input",{type:"file",onChange:t[3]||(t[3]=(...e)=>I.onImageUpload&&I.onImageUpload(...e))},null,32),(0,i.Lk)("div",{class:"plus",onClick:t[4]||(t[4]=e=>e.target.previousElementSibling.click())},"+")])):(0,i.Q3)("",!0)]),(0,i.Lk)("button",{class:"submit-button",onClick:t[5]||(t[5]=(...e)=>I.submitNotice&&I.submitNotice(...e)),disabled:e.isLoading}," 완료",8,v)])):(0,i.Q3)("",!0)]),b.show401Popup?((0,i.uX)(),(0,i.Wv)(w,{key:0})):(0,i.Q3)("",!0)],64)}var b=n(4373),I=n(5968),w=n(6799),y={name:"NoticeWrite",components:{Popup401:w.A},props:["noticeUUID"],data(){return{notice:{noticeTitle:"",noticeContent:""},images:[],show401Popup:!1}},methods:{deleteImage(e){this.images.splice(e,1),this.$refs[`fileInput${e}`]=null},handle401Error(e){return!(!e.response||401!==e.response.status)&&(this.show401Popup=!0,!0)},onImageUpload(e){const t=e.target.files[0];if(t){const n=["png","jpg","jpeg"],i=t.name.split(".").pop().toLowerCase(),o=10485760;if(n.includes(i)&&t.size<=o){const n=new FileReader;n.onload=n=>{this.images.push({src:n.target.result,file:t}),e.target.value=""},n.readAsDataURL(t)}else alert("파일 형식이 맞지 않거나 크기가 초과되었습니다. (10MB 이하, png/jpg만 허용)")}},editImage(e){const t=this.$refs.fileInputs;t&&t[e]?t[e].click():console.error(`File input not found for index ${e}`)},editImage(e){this.$refs[`fileInput${e}`][0].click()},onImageChange(e,t){if(!t||!t.target||!t.target.files)return void console.error("Invalid event object:",t);const n=t.target.files[0];if(!n)return;const i=["png","jpg","jpeg","gif","bmp","webp","tiff"],o=n.name.split(".").pop().toLowerCase(),s=10485760;if(i.includes(o)&&n.size<=s){const t=new FileReader;t.onload=t=>{this.images[e]={...this.images[e],src:t.target.result,file:n}},t.readAsDataURL(n)}else alert("파일 형식이 맞지 않거나 크기가 초과되었습니다. (10MB 이하, png/jpg만 허용)")},async submitNotice(){const e=200,t=3e3;if(this.notice.noticeTitle.length>e)alert(`공지사항 제목은 최대 ${e}자까지 입력 가능합니다.`);else if(this.notice.noticeContent.length>t)alert(`공지사항 내용은 최대 ${t}자까지 입력 가능합니다.`);else try{const e=new FormData,t={noticeTitle:this.notice.noticeTitle,noticeContent:this.notice.noticeContent.replace(/ /g,"&nbsp;").replace(/\n/g,"<br>"),photoOrders:this.images.length>0?this.images.map((e,t)=>t+1):[]};e.append("request",new Blob([JSON.stringify(t)],{type:"application/json"})),this.images.length>0&&this.images.forEach((t,n)=>{console.log(`(${n+1}/${this.images.length})`),e.append("photos",t.file)});const n=await b.A.post(`${I.A.state.apiBaseUrl}/notices`,e,{headers:{Authorization:`Bearer ${I.A.state.accessToken}`,"Content-Type":"multipart/form-data"}});if(!n||!n.data)return console.error("응답 데이터 없음"),void alert("공지사항 제출에 실패했습니다. 다시 시도해주세요.");if([401,400,422].includes(n.status)){let e="";return 401===n.status?(e="인증되지 않은 사용자입니다. 다시 로그인해주세요.",this.$router.push({name:"Login"})):400===n.status?e="업로드 가능한 사진 갯수를 초과했습니다.":422===n.status&&(e="제목과 내용을 모두 입력해주세요."),void alert(e)}const i=n?.data?.data||[];if(!Array.isArray(i)||0===i.length)return alert("공지사항이 성공적으로 등록되었습니다."),void this.$router.push({name:"Notice"});await Promise.all(i.map(async(e,t)=>{const n=this.images[t].file;await b.A.put(e,n,{headers:{"Content-Type":n.type}})})),alert("공지사항이 성공적으로 등록되었습니다."),this.$router.push({name:"Notice"})}catch(n){if(n.response&&401===n.response.status)return void(this.show401Popup=!0);if(n.response&&400===n.response.status){const e=n.response.data.additionalData;return e.noticeTitle&&alert(e.noticeTitle),void(e.noticeContent&&alert(e.noticeContent))}console.error("공지사항 제출 실패:",n.response||n.message),alert("공지사항 제출에 실패했습니다. 다시 시도해주세요.")}}}},$=n(1241);const A=(0,$.A)(y,[["render",L],["__scopeId","data-v-48945014"]]);var T=A}}]);
//# sourceMappingURL=253.205b2108.js.map