"use strict";(self["webpackChunkdonggurami"]=self["webpackChunkdonggurami"]||[]).push([[432],{8019:function(o,a,e){e.r(a),e.d(a,{default:function(){return R}});var s=e(6768),r=e(4232),l=e.p+"img/zoom.dff1c6a1.svg",n=e.p+"img/remove.5ab61d54.svg";const t={class:"floor-images-container"},i={class:"floor-section"},c={class:"floor-container"},g={class:"image-container"},u={class:"image-wrapper"},p=["src"],d={key:1,class:"icons-container"},m={class:"upload-placeholder"},h={class:"floor-container"},f={class:"image-container"},k={class:"image-wrapper"},v=["src"],I={key:1,class:"icons-container"},L={class:"upload-placeholder"},w={class:"floor-container"},F={class:"image-container"},C={class:"image-wrapper"},D=["src"],y={key:1,class:"icons-container"},S={class:"upload-placeholder"},b={key:0,class:"image-modal"},M=["src"];function B(o,a,e,B,E,A){const U=(0,s.g2)("ClubroomMapUploadPopup"),P=(0,s.g2)("Popup401");return(0,s.uX)(),(0,s.CE)(s.FK,null,[a[26]||(a[26]=(0,s.Lk)("div",{class:"title"},"동아리 위치 정보 수정",-1)),(0,s.Lk)("div",t,[(0,s.Lk)("div",i,[(0,s.Lk)("div",c,[(0,s.Lk)("div",g,[(0,s.Lk)("div",u,[(0,s.Lk)("div",{class:(0,r.C4)(["image-box",{hovered:E.floorData.B1.showingIcon}]),onMouseover:a[2]||(a[2]=o=>A.showIcons("B1",!0)),onMouseleave:a[3]||(a[3]=o=>A.showIcons("B1",!1))},[E.floorData.B1.imageSrc?((0,s.uX)(),(0,s.CE)("img",{key:0,src:E.floorData.B1.imageSrc,alt:"Floor Image",class:"floor-image"},null,8,p)):(0,s.Q3)("",!0),E.floorData.B1.showingIcon?((0,s.uX)(),(0,s.CE)("div",d,[(0,s.Lk)("img",{src:l,class:"icon zoom-icon",onClick:a[0]||(a[0]=o=>A.enlargeImage(E.floorData.B1.imageSrc))}),(0,s.Lk)("img",{src:n,class:"icon remove-icon",onClick:a[1]||(a[1]=o=>A.markImageForDeletion("B1"))})])):(0,s.Q3)("",!0)],34)]),a[21]||(a[21]=(0,s.Lk)("h3",null,"지하 1층",-1)),(0,s.Lk)("div",m,[(0,s.Lk)("button",{onClick:a[4]||(a[4]=o=>A.triggerFileInput("B1")),class:"upload-button"},a[20]||(a[20]=[(0,s.Lk)("i",{class:"upload-icon"},null,-1),(0,s.eW)(" 이미지 수정 ")]))]),(0,s.Lk)("input",{type:"file",ref:"fileInputB1",onChange:a[5]||(a[5]=o=>A.onImageUpload("B1",o)),style:{display:"none"}},null,544)])]),(0,s.Lk)("div",h,[(0,s.Lk)("div",f,[(0,s.Lk)("div",k,[(0,s.Lk)("div",{class:(0,r.C4)(["image-box",{hovered:E.floorData.F1.showingIcon}]),onMouseover:a[8]||(a[8]=o=>A.showIcons("F1",!0)),onMouseleave:a[9]||(a[9]=o=>A.showIcons("F1",!1))},[E.floorData.F1.imageSrc?((0,s.uX)(),(0,s.CE)("img",{key:0,src:E.floorData.F1.imageSrc,alt:"Floor Image",class:"floor-image"},null,8,v)):(0,s.Q3)("",!0),E.floorData.F1.showingIcon?((0,s.uX)(),(0,s.CE)("div",I,[(0,s.Lk)("img",{src:l,class:"icon zoom-icon",onClick:a[6]||(a[6]=o=>A.enlargeImage(E.floorData.F1.imageSrc))}),(0,s.Lk)("img",{src:n,class:"icon remove-icon",onClick:a[7]||(a[7]=o=>A.markImageForDeletion("F1"))})])):(0,s.Q3)("",!0)],34),a[23]||(a[23]=(0,s.Lk)("h3",null,"지상 1층",-1)),(0,s.Lk)("div",L,[(0,s.Lk)("button",{onClick:a[10]||(a[10]=o=>A.triggerFileInput("F1")),class:"upload-button"},a[22]||(a[22]=[(0,s.Lk)("i",{class:"upload-icon"},null,-1),(0,s.eW)(" 이미지 수정 ")]))]),(0,s.Lk)("input",{type:"file",ref:"fileInputF1",onChange:a[11]||(a[11]=o=>A.onImageUpload("F1",o)),style:{display:"none"}},null,544)])])]),(0,s.Lk)("div",w,[(0,s.Lk)("div",F,[(0,s.Lk)("div",C,[(0,s.Lk)("div",{class:(0,r.C4)(["image-box",{hovered:E.floorData.F2.showingIcon}]),onMouseover:a[14]||(a[14]=o=>A.showIcons("F2",!0)),onMouseleave:a[15]||(a[15]=o=>A.showIcons("F2",!1))},[E.floorData.F2.imageSrc?((0,s.uX)(),(0,s.CE)("img",{key:0,src:E.floorData.F2.imageSrc,alt:"Floor Image",class:"floor-image"},null,8,D)):(0,s.Q3)("",!0),E.floorData.F2.showingIcon?((0,s.uX)(),(0,s.CE)("div",y,[(0,s.Lk)("img",{src:l,class:"icon zoom-icon",onClick:a[12]||(a[12]=o=>A.enlargeImage(E.floorData.F2.imageSrc))}),(0,s.Lk)("img",{src:n,class:"icon remove-icon",onClick:a[13]||(a[13]=o=>A.markImageForDeletion("F2"))})])):(0,s.Q3)("",!0)],34),a[25]||(a[25]=(0,s.Lk)("h3",null,"지상 2층",-1)),(0,s.Lk)("div",S,[(0,s.Lk)("button",{onClick:a[16]||(a[16]=o=>A.triggerFileInput("F2")),class:"upload-button"},a[24]||(a[24]=[(0,s.Lk)("i",{class:"upload-icon"},null,-1),(0,s.eW)(" 이미지 수정 ")]))]),(0,s.Lk)("input",{type:"file",ref:"fileInputF2",onChange:a[17]||(a[17]=o=>A.onImageUpload("F2",o)),style:{display:"none"}},null,544)])])])]),(0,s.Lk)("button",{onClick:a[18]||(a[18]=(...o)=>A.saveImages&&A.saveImages(...o)),class:"save-button"},"저장하기"),E.enlargedImage?((0,s.uX)(),(0,s.CE)("div",b,[(0,s.Lk)("img",{src:n,class:"remove-icon-modal",onClick:a[19]||(a[19]=(...o)=>A.closeModal&&A.closeModal(...o)),alt:"Close Modal"}),(0,s.Lk)("img",{src:E.enlargedImage,alt:"Enlarged Image",class:"enlarged-image"},null,8,M)])):(0,s.Q3)("",!0)]),E.showPopup?((0,s.uX)(),(0,s.Wv)(U,{key:0,serverMessage:E.serverMessage,onClose:A.closeResultPopup},null,8,["serverMessage","onClose"])):(0,s.Q3)("",!0),E.show401Popup?((0,s.uX)(),(0,s.Wv)(P,{key:1})):(0,s.Q3)("",!0)],64)}var E=e(4373),A=e(5968),U=e(6799);const P={class:"popup-overlay"},$={class:"popup"},X={class:"confirm-message"};function Q(o,a,e,l,n,t){return(0,s.uX)(),(0,s.CE)("div",P,[(0,s.Lk)("div",$,[a[1]||(a[1]=(0,s.Lk)("div",{class:"popup-header"},"동아리 위치 정보 수정",-1)),(0,s.Lk)("p",X,(0,r.v_)(t.message),1),(0,s.Lk)("button",{onClick:a[0]||(a[0]=a=>o.$emit("close")),class:"confirm-button"},"확인")])])}var z={name:"ClubroomMapUploadPopup",props:{serverMessage:{type:String,required:!0}},computed:{message(){return this.serverMessage}}},j=e(1241);const _=(0,j.A)(z,[["render",Q],["__scopeId","data-v-3cad49f6"]]);var O=_,T={components:{ClubroomMapUploadPopup:O,Popup401:U.A},data(){return{floorData:{B1:{imageSrc:"",originalImageSrc:"",file:null,showingIcon:!1},F1:{imageSrc:"",originalImageSrc:"",file:null,showingIcon:!1},F2:{imageSrc:"",originalImageSrc:"",file:null,showingIcon:!1}},showPopup:!1,serverMessage:"",enlargedImage:null,show401Popup:!1}},async created(){await this.fetchImages()},methods:{handle401Error(o){const{code:a}=o.response?.data||{};return 401===a&&(this.show401Popup=!0,!0)},async fetchImages(){const o=A.A.state.accessToken;try{const a=Object.keys(this.floorData),e=a.map(a=>E.A.get(`${A.A.state.apiBaseUrl}/admin/floor/photo/${a}`,{headers:{Authorization:`Bearer ${o}`}}).catch(o=>{const{code:e}=o.response?.data||{};if(404===e||"NOT_FOUND"===e)return console.warn(`층 ${a}에 대한 이미지를 찾을 수 없습니다.`),null;if(this.handle401Error(o))return null;throw o})),s=await Promise.all(e);s.forEach((o,a)=>{if(o&&o.data&&o.data.data){const e=Object.keys(this.floorData)[a];this.floorData[e].imageSrc=o.data.data.presignedUrl,this.floorData[e].originalImageSrc=o.data.data.presignedUrl}})}catch(a){this.handle401Error(a)||(console.error("이미지 불러오기 실패:",a.response?.data||a),alert("이미지를 불러오는 데 실패했습니다."))}},triggerFileInput(o){const a=this.$refs[`fileInput${o}`];a&&a.click()},onImageUpload(o,a){const e=a.target.files[0];if(!e)return;const s=["png","jpg","jpeg"],r=e.name.split(".").pop().toLowerCase(),l=10485760;if(!s.includes(r)||e.size>l)return alert("파일 형식이 잘못되었거나 크기가 초과되었습니다. (10MB 이하, png 또는 jpg만 허용)"),void(a.target.value="");const n=new FileReader;n.onload=a=>{this.floorData[o].imageSrc=a.target.result,this.floorData[o].file=e},n.readAsDataURL(e),a.target.value=""},async saveImages(){const o=A.A.state.accessToken;try{const e=Object.keys(this.floorData);for(const s of e){const{imageSrc:e,file:r,originalImageSrc:l}=this.floorData[s];if(!e&&!r&&l)try{await E.A.delete(`${A.A.state.apiBaseUrl}/admin/floor/photo/${s}`,{headers:{Authorization:`Bearer ${o}`}}),console.log(`층 ${s} 이미지 삭제 성공`)}catch(a){if(this.handle401Error(a))return;throw a}}for(const s of e){const{file:e}=this.floorData[s];if(e){const r=new FormData;r.append("photo",e);try{const a=await E.A.put(`${A.A.state.apiBaseUrl}/admin/floor/photo/${s}`,r,{headers:{Authorization:`Bearer ${o}`,"Content-Type":"multipart/form-data"}});if(a.data&&a.data.data.presignedUrl){const o=a.data.data.presignedUrl;await E.A.put(o,e,{headers:{"Content-Type":e.type}}),this.floorData[s].imageSrc=o,this.floorData[s].originalImageSrc=o,console.log(`층 ${s} 이미지 저장 성공`)}}catch(a){if(this.handle401Error(a))return;throw a}}}this.serverMessage="동아리 위치 정보가 정상적으로 저장되었습니다.",this.showPopup=!0,await this.fetchImages()}catch(a){this.handle401Error(a)||(console.error("이미지 저장 실패:",a.response?.data||a),alert("이미지 저장에 실패했습니다."))}},markImageForDeletion(o){this.floorData[o].imageSrc=null,this.floorData[o].file=null},enlargeImage(o){this.enlargedImage=o},closeModal(){this.enlargedImage=null},showIcons(o,a){this.floorData[o].showingIcon=a},closeResultPopup(){this.showPopup=!1}}};const W=(0,j.A)(T,[["render",B],["__scopeId","data-v-6c0db6a3"]]);var R=W}}]);
//# sourceMappingURL=432.a64f5290.js.map