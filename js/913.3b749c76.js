"use strict";(self["webpackChunkdonggurami"]=self["webpackChunkdonggurami"]||[]).push([[913],{9178:function(a,o,e){e.r(o),e.d(o,{default:function(){return _}});var s=e(6768),r=e(4232),l=e.p+"img/zoom.dff1c6a1.svg",t=e.p+"img/remove.5ab61d54.svg";const n={class:"floor-images-container"},i={class:"floor-container"},c={class:"image-wrapper"},g=["src"],u={key:1,class:"icons-container"},p={class:"upload-placeholder"},d={class:"floor-container"},m={class:"image-wrapper"},h=["src"],f={key:1,class:"icons-container"},k={class:"upload-placeholder"},v={class:"floor-container"},I={class:"image-wrapper"},w=["src"],L={key:1,class:"icons-container"},F={class:"upload-placeholder"},C={key:0,class:"image-modal"},D=["src"];function y(a,o,e,y,S,b){const M=(0,s.g2)("ClubroomMapUploadPopup"),B=(0,s.g2)("Popup401");return(0,s.uX)(),(0,s.CE)(s.FK,null,[o[24]||(o[24]=(0,s.Lk)("div",{class:"title"},"동아리 위치 정보 수정",-1)),(0,s.Lk)("div",n,[(0,s.Lk)("div",i,[(0,s.Lk)("div",c,[(0,s.Lk)("div",{class:"image-container",onMouseover:o[2]||(o[2]=a=>b.showIcons("B1",!0)),onMouseleave:o[3]||(o[3]=a=>b.showIcons("B1",!1))},[(0,s.Lk)("div",{class:(0,r.C4)(["image-box",{hovered:S.floorData.B1.showingIcon}])},[S.floorData.B1.imageSrc?((0,s.uX)(),(0,s.CE)("img",{key:0,src:S.floorData.B1.imageSrc,alt:"Floor Image",class:"floor-image"},null,8,g)):(0,s.Q3)("",!0),S.floorData.B1.showingIcon?((0,s.uX)(),(0,s.CE)("div",u," … ")):(0,s.Q3)("",!0)],2),o[19]||(o[19]=(0,s.Lk)("h3",null,"지하 1층",-1)),(0,s.Lk)("div",p,[(0,s.Lk)("button",{onClick:o[0]||(o[0]=a=>b.triggerFileInput("B1")),class:"upload-button"},o[18]||(o[18]=[(0,s.Lk)("i",{class:"upload-icon"},null,-1),(0,s.eW)(" 이미지 수정 ")]))]),(0,s.Lk)("input",{type:"file",ref:"fileInputB1",onChange:o[1]||(o[1]=a=>b.onImageUpload("B1",a)),style:{display:"none"}},null,544)],32)])]),(0,s.Lk)("div",d,[(0,s.Lk)("div",m,[(0,s.Lk)("div",{class:"image-container",onMouseover:o[8]||(o[8]=a=>b.showIcons("F1",!0)),onMouseleave:o[9]||(o[9]=a=>b.showIcons("F1",!1))},[(0,s.Lk)("div",{class:(0,r.C4)(["image-box",{hovered:S.floorData.F1.showingIcon}])},[S.floorData.F1.imageSrc?((0,s.uX)(),(0,s.CE)("img",{key:0,src:S.floorData.F1.imageSrc,alt:"Floor Image",class:"floor-image"},null,8,h)):(0,s.Q3)("",!0),S.floorData.F1.showingIcon?((0,s.uX)(),(0,s.CE)("div",f,[(0,s.Lk)("img",{src:l,class:"icon zoom-icon",onClick:o[4]||(o[4]=a=>b.enlargeImage(S.floorData.F1.imageSrc))}),(0,s.Lk)("img",{src:t,class:"icon remove-icon",onClick:o[5]||(o[5]=a=>b.markImageForDeletion("F1"))})])):(0,s.Q3)("",!0)],2),o[21]||(o[21]=(0,s.Lk)("h3",null,"지상 1층",-1)),(0,s.Lk)("div",k,[(0,s.Lk)("button",{onClick:o[6]||(o[6]=a=>b.triggerFileInput("F1")),class:"upload-button"},o[20]||(o[20]=[(0,s.Lk)("i",{class:"upload-icon"},null,-1),(0,s.eW)(" 이미지 수정 ")]))]),(0,s.Lk)("input",{type:"file",ref:"fileInputF1",onChange:o[7]||(o[7]=a=>b.onImageUpload("F1",a)),style:{display:"none"}},null,544)],32)])]),(0,s.Lk)("div",v,[(0,s.Lk)("div",I,[(0,s.Lk)("div",{class:"image-container",onMouseover:o[14]||(o[14]=a=>b.showIcons("F2",!0)),onMouseleave:o[15]||(o[15]=a=>b.showIcons("F2",!1))},[(0,s.Lk)("div",{class:(0,r.C4)(["image-box",{hovered:S.floorData.F2.showingIcon}])},[S.floorData.F2.imageSrc?((0,s.uX)(),(0,s.CE)("img",{key:0,src:S.floorData.F2.imageSrc,alt:"Floor Image",class:"floor-image"},null,8,w)):(0,s.Q3)("",!0),S.floorData.F2.showingIcon?((0,s.uX)(),(0,s.CE)("div",L,[(0,s.Lk)("img",{src:l,class:"icon zoom-icon",onClick:o[10]||(o[10]=a=>b.enlargeImage(S.floorData.F2.imageSrc))}),(0,s.Lk)("img",{src:t,class:"icon remove-icon",onClick:o[11]||(o[11]=a=>b.markImageForDeletion("F2"))})])):(0,s.Q3)("",!0)],2),o[23]||(o[23]=(0,s.Lk)("h3",null,"지상 2층",-1)),(0,s.Lk)("div",F,[(0,s.Lk)("button",{onClick:o[12]||(o[12]=a=>b.triggerFileInput("F2")),class:"upload-button"},o[22]||(o[22]=[(0,s.Lk)("i",{class:"upload-icon"},null,-1),(0,s.eW)(" 이미지 수정 ")]))]),(0,s.Lk)("input",{type:"file",ref:"fileInputF2",onChange:o[13]||(o[13]=a=>b.onImageUpload("F2",a)),style:{display:"none"}},null,544)],32)])])]),(0,s.Lk)("button",{onClick:o[16]||(o[16]=(...a)=>b.saveImages&&b.saveImages(...a)),class:"save-button"},"저장하기"),S.enlargedImage?((0,s.uX)(),(0,s.CE)("div",C,[(0,s.Lk)("img",{src:t,class:"remove-icon-modal",onClick:o[17]||(o[17]=(...a)=>b.closeModal&&b.closeModal(...a)),alt:"Close Modal"}),(0,s.Lk)("img",{src:S.enlargedImage,alt:"Enlarged Image",class:"enlarged-image"},null,8,D)])):(0,s.Q3)("",!0),S.showPopup?((0,s.uX)(),(0,s.Wv)(M,{key:1,serverMessage:S.serverMessage,onClose:b.closeResultPopup},null,8,["serverMessage","onClose"])):(0,s.Q3)("",!0),S.show401Popup?((0,s.uX)(),(0,s.Wv)(B,{key:2})):(0,s.Q3)("",!0)],64)}var S=e(4373),b=e(5968),M=e(6799);const B={class:"popup-overlay"},E={class:"popup"},A={class:"confirm-message"};function U(a,o,e,l,t,n){return(0,s.uX)(),(0,s.CE)("div",B,[(0,s.Lk)("div",E,[o[1]||(o[1]=(0,s.Lk)("div",{class:"popup-header"},"동아리 위치 정보 수정",-1)),(0,s.Lk)("p",A,(0,r.v_)(n.message),1),(0,s.Lk)("button",{onClick:o[0]||(o[0]=o=>a.$emit("close")),class:"confirm-button"},"확인")])])}var P={name:"ClubroomMapUploadPopup",props:{serverMessage:{type:String,required:!0}},computed:{message(){return this.serverMessage}}},$=e(1241);const X=(0,$.A)(P,[["render",U],["__scopeId","data-v-450d55c4"]]);var Q=X,z={components:{ClubroomMapUploadPopup:Q,Popup401:M.A},data(){return{floorData:{B1:{imageSrc:"",originalImageSrc:"",file:null,showingIcon:!1},F1:{imageSrc:"",originalImageSrc:"",file:null,showingIcon:!1},F2:{imageSrc:"",originalImageSrc:"",file:null,showingIcon:!1}},showPopup:!1,serverMessage:"",enlargedImage:null,show401Popup:!1}},async created(){await this.fetchImages()},methods:{handle401Error(a){const{code:o}=a.response?.data||{};return 401===o&&(this.show401Popup=!0,!0)},async fetchImages(){const a=b.A.state.accessToken;try{const o=Object.keys(this.floorData),e=o.map(o=>S.A.get(`${b.A.state.apiBaseUrl}/admin/floor/photo/${o}`,{headers:{Authorization:`Bearer ${a}`}}).catch(a=>{const{code:e}=a.response?.data||{};if(404===e||"NOT_FOUND"===e)return console.warn(`층 ${o}에 대한 이미지를 찾을 수 없습니다.`),null;if(this.handle401Error(a))return null;throw a})),s=await Promise.all(e);s.forEach((a,o)=>{if(a&&a.data&&a.data.data){const e=Object.keys(this.floorData)[o];this.floorData[e].imageSrc=a.data.data.presignedUrl,this.floorData[e].originalImageSrc=a.data.data.presignedUrl}})}catch(o){this.handle401Error(o)||(console.error("이미지 불러오기 실패:",o.response?.data||o),alert("이미지를 불러오는 데 실패했습니다."))}},triggerFileInput(a){const o=this.$refs[`fileInput${a}`];o&&o.click()},onImageUpload(a,o){const e=o.target.files[0];if(!e)return;const s=["png","jpg","jpeg"],r=e.name.split(".").pop().toLowerCase(),l=10485760;if(!s.includes(r)||e.size>l)return alert("파일 형식이 잘못되었거나 크기가 초과되었습니다. (10MB 이하, png 또는 jpg만 허용)"),void(o.target.value="");const t=new FileReader;t.onload=o=>{this.floorData[a].imageSrc=o.target.result,this.floorData[a].file=e},t.readAsDataURL(e),o.target.value=""},async saveImages(){const a=b.A.state.accessToken;try{const e=Object.keys(this.floorData);for(const s of e){const{imageSrc:e,file:r,originalImageSrc:l}=this.floorData[s];if(!e&&!r&&l)try{await S.A.delete(`${b.A.state.apiBaseUrl}/admin/floor/photo/${s}`,{headers:{Authorization:`Bearer ${a}`}}),console.log(`층 ${s} 이미지 삭제 성공`)}catch(o){if(this.handle401Error(o))return;throw o}}for(const s of e){const{file:e}=this.floorData[s];if(e){const r=new FormData;r.append("photo",e);try{const o=await S.A.put(`${b.A.state.apiBaseUrl}/admin/floor/photo/${s}`,r,{headers:{Authorization:`Bearer ${a}`,"Content-Type":"multipart/form-data"}});if(o.data&&o.data.data.presignedUrl){const a=o.data.data.presignedUrl;await S.A.put(a,e,{headers:{"Content-Type":e.type}}),this.floorData[s].imageSrc=a,this.floorData[s].originalImageSrc=a,console.log(`층 ${s} 이미지 저장 성공`)}}catch(o){if(this.handle401Error(o))return;throw o}}}this.serverMessage="동아리 위치 정보가 정상적으로 저장되었습니다.",this.showPopup=!0,await this.fetchImages()}catch(o){this.handle401Error(o)||(console.error("이미지 저장 실패:",o.response?.data||o),alert("이미지 저장에 실패했습니다."))}},markImageForDeletion(a){this.floorData[a].imageSrc=null,this.floorData[a].file=null},enlargeImage(a){this.enlargedImage=a},closeModal(){this.enlargedImage=null},showIcons(a,o){this.floorData[a].showingIcon=o},closeResultPopup(){this.showPopup=!1}}};const j=(0,$.A)(z,[["render",y],["__scopeId","data-v-a09ae66c"]]);var _=j}}]);
//# sourceMappingURL=913.3b749c76.js.map